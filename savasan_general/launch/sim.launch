<launch>
    <!-- MAVROS Configuration -->
    <arg name="fcu_url"        default="udp://:14550@:14550" />
    <arg name="gcs_url"        default="udp://:14540@:14540" />
    <arg name="tgt_system"     default="1" />
    <arg name="tgt_component"  default="1" />
    <arg name="log_output"     default="screen" />
    <arg name="fcu_protocol"   default="v2.0" />
    <arg name="respawn_mavros" default="true" />

    <include file="$(find mavros)/launch/node.launch">
        <arg name="pluginlists_yaml" value="$(find mavros)/launch/apm_pluginlists.yaml" />
        <arg name="config_yaml"      value="$(find mavros)/launch/apm_config.yaml" />
        <arg name="fcu_url"          value="$(arg fcu_url)" />
        <arg name="gcs_url"          value="$(arg gcs_url)" />
        <arg name="tgt_system"       value="$(arg tgt_system)" />
        <arg name="tgt_component"    value="$(arg tgt_component)" />
        <arg name="log_output"       value="$(arg log_output)" />
        <arg name="fcu_protocol"     value="$(arg fcu_protocol)" />
        <arg name="respawn_mavros"   value="$(arg respawn_mavros)" />
    </include>

    <!-- server_comm Node Configuration -->
    <node name="comm_node" pkg="server_comm" type="comm_node.py" output="screen">
        <param name="/api/telemetri_gonder"   value="http://127.0.0.1:5000/api/telemetri_gonder" /> <!-- Update it according to your server IP -->
        <param name="/api/kilitlenme_bilgisi" value="http://127.0.0.1:5000/api/kilitlenme_bilgisi" />
        <param name="/api/sunucusaati"        value="http://127.0.0.1:5000/api/sunucusaati" />
        <param name="/api/qr_koordinati"      value="http://127.0.0.1:5000/api/qr_koordinati" />
        <param name="/api/kamikaze_bilgisi"   value="http://127.0.0.1:5000/api/kamikaze_bilgisi" />
    </node>

    <node name="camera_publisher"     pkg="image_handler"     type="camera_publisher.py"      output="screen"/>
    <node name ="waypoint_node"       pkg="kamikaze"          type="waypoint.py"              output="screen" />
    <node name ="pose_publisher_node" pkg="kamikaze"          type="pose_publisher.py"        output="screen" />
    <node name="yolov8_node"          pkg="yolov8"            type="yolov8_node.py"           output="screen"/>
    <node name="image_processor_node" pkg="image_processor"   type="image_processor_node.py"  output="screen"/>
    <node name="image_save"           pkg="image_processor"   type="image_save.py"            output="screen"/>
    <node name="gps_navigator"        pkg="gps_navigator"     type="gps_navigator_node.py"    output="screen"/>
    <node name="uav_visualization"    pkg="uav_visualization" type="iha_subscriber.py"        output="screen"/>
    <node name="home_gps_publisher"   pkg="savasan_general"   type="home_gps_publisher.py"    output="screen"/> <!-- Home GPS Publisher -->

    <!-- Start RViz with the specified configuration file -->
    <node pkg="tf"   type="static_transform_publisher" name="odom_to_map_broadcaster" args="0 0 0 0 0 0 map odom 100" />
    <node pkg="rviz" type="rviz"                       name="rviz"                    args="-d $(find rviz_satellite)/launch/demo.rviz"/>
</launch>
