<launch>
    <!-- MAVROS Configuration -->
    <arg name="fcu_url"             default="udp://:14550@:14550" />
    <arg name="gcs_url"             default="udp://@localhost:14530" />
    <arg name="tgt_system"          default="1" />
    <arg name="tgt_component"       default="1" />
    <arg name="log_output"          default="screen" />
    <arg name="fcu_protocol"        default="v2.0" />
    <arg name="respawn_mavros"      default="true" />
    <arg name="gui"                 default="true" />

    <include file="$(find mavros)/launch/node.launch">
        <arg name="pluginlists_yaml" value="$(find savasan_general)/launch/apm_pluginlists.yaml" />
        <arg name="config_yaml"      value="$(find savasan_general)/launch/apm_config.yaml" />
        <arg name="fcu_url"          value="$(arg fcu_url)" />
        <arg name="gcs_url"          value="$(arg gcs_url)" />
        <arg name="tgt_system"       value="$(arg tgt_system)" />
        <arg name="tgt_component"    value="$(arg tgt_component)" />
        <arg name="log_output"       value="$(arg log_output)" />
        <arg name="fcu_protocol"     value="$(arg fcu_protocol)" />
        <arg name="respawn_mavros"   value="$(arg respawn_mavros)" />
    </include>

    <!-- server_comm Node Configuration -->
    <node name="comm_node" pkg="server_comm" type="comm_node.py" output="screen">
        <param name="/api/telemetri_gonder"   value="http://savasaniha.baykartech.com/api/telemetri_gonder" /> <!-- Update it according to your server IP -->
        <param name="/api/kilitlenme_bilgisi" value="http://savasaniha.baykartech.com/api/kilitlenme_bilgisi" />
        <param name="/api/sunucusaati"        value="http://savasaniha.baykartech.com/api/sunucusaati" />
        <param name="/api/qr_koordinati"      value="http://savasaniha.baykartech.com/api/qr_koordinati" />
        <param name="/api/kamikaze_bilgisi"   value="http://savasaniha.baykartech.com/api/kamikaze_bilgisi" />
        <param name="/api/hss_koordinatlari"  value="http://savasaniha.baykartech.com/api/hss_koordinatlari" />
        <param name="Home_Lat"                value="39.81910211"/>
        <param name="Home_Lon"                value="30.53401693"/>
        <param name="Home_Alt"                value="788.7"/>
        <param name="Target_Lat"              value="39.82041602"/>
        <param name="Target_Lon"              value="30.53387217"/>
        <param name="Target_Alt"              value="10"/>
    </node>

    <node name="savasan_gui_node" pkg="template_gui_package" type="savasan_gui_node" output="screen">
        <param name="use_gui"             value="$(arg gui)" />
        <param name="competition_online"  value="false" />
        <param name="yolo_online"         value="false" />
        <param name="tracing_online"      value="false" />
        <param name="kamikaze_online"     value="false" />
        <param name="usePID"              value="false" />

    </node>

    <node name="camera_publisher"       pkg="image_handler"     type="camera_publisher.py"      output="screen">
        <param name="screen_width"            value="1920"/>
        <param name="screen_height"           value="1080"/>
    </node>

    <node name="kamikaze_node"          pkg="kamikaze"          type="kamikaze.py"              output="screen"/>
    <node name="pose_publisher_node"    pkg="kamikaze"          type="pose_publisher.py"        output="screen"/>
    <node name="QR_node"                pkg="kamikaze"          type="QR_node.py"               output="screen"/>
    <node name="yolov8_node"            pkg="yolov8"            type="yolov8_node.py"           output="screen"/>
    <node name="lock_checker_node"      pkg="yolov8"            type="lock_checker.py"          output="screen"/>
    <node name="image_processor_node"   pkg="image_processor"   type="image_processor_node.py"  output="screen"/>
    <node name="image_save"             pkg="image_processor"   type="image_save.py"            output="screen"/>
    <node name="gps_navigator"          pkg="gps_navigator"     type="gps_navigator_node.py"    output="screen"/>
    <node name="impact_prevention_node" pkg="gps_navigator"     type="impact_prevention.py"     output="screen"/>
    <node name="air_defense_node"       pkg="hss"               type="air_defense_node.py"      output="screen"/>
    <node name="uav_visualization"      pkg="uav_visualization" type="iha_subscriber.py"        output="screen"/>
    <node name="plane_model"            pkg="uav_visualization" type="plane_model.py"           output="screen"/>
    <node name="home_gps_publisher"     pkg="savasan_general"   type="home_gps_publisher,py"    output="screen"/> 

    <!-- Start RViz with the specified configuration file -->
    <node pkg="tf"            type="static_transform_publisher" name="odom_to_map_broadcaster" args="0 0 0 0 0 0 map odom 100" />
    <node pkg="rviz"          type="rviz"                       name="rviz"                    args="-d $(find rviz_satellite)/launch/demo.rviz"/>
</launch>
